<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Copiar materias</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-5 mb-5">

    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">

            <div class="card shadow-sm border-0">

                <div class="card-header bg-dark text-white text-center">
                    <h4 class="mb-0">ðŸ“„ Copiar materias del mes anterior</h4>
                </div>

                <div class="card-body p-4">

                    <p class="text-muted text-center mb-4">
                        SeleccionÃ¡ las materias que querÃ©s copiar a la nueva liquidaciÃ³n.
                    </p>

                    <form method="post" action="{{ url_for('confirmar_copia') }}">

                        <input type="hidden" name="profesor_id" value="{{ profesor_id }}">
                        <input type="hidden" name="mes" value="{{ mes }}">
                        <input type="hidden" name="anio" value="{{ anio }}">

                        <!-- BOTONES NUEVOS -->
                        <div class="d-flex justify-content-between mb-3">
                            <button type="button" class="btn btn-outline-primary btn-sm" onclick="seleccionarTodos()">
                                Seleccionar todos
                            </button>

                            <button type="button" class="btn btn-outline-secondary btn-sm" onclick="deseleccionarTodos()">
                                Deseleccionar todos
                            </button>
                        </div>

                        <div class="mb-4" id="lista-materias">

                            {% for d in detalles %}
                            <div class="form-check mb-2 p-2 rounded border materia-item"
                                 data-horario="{{ d.horario }}">

                                <input class="form-check-input me-2"
                                       type="checkbox"
                                       name="detalles"
                                       value="{{ d.id }}"
                                       checked
                                       id="detalle{{ d.id }}">

                                <label class="form-check-label fw-semibold"
                                       for="detalle{{ d.id }}">

                                    {{ d.materia }}

                                    <div class="small text-muted">
                                        {{ d.horario }}
                                    </div>

                                </label>

                            </div>
                            {% endfor %}

                        </div>

                        <div class="d-flex gap-3">
                            <button type="submit"
                                    class="btn btn-success w-50 py-2">
                                ðŸ’¾ Crear liquidaciÃ³n
                            </button>

                            <a href="{{ url_for('index') }}"
                               class="btn btn-secondary w-50 py-2">
                                Volver
                            </a>
                        </div>

                    </form>

                </div>

            </div>

        </div>
    </div>

</div>

<!-- JAVASCRIPT -->
<script>

function seleccionarTodos() {
    document.querySelectorAll('input[name="detalles"]').forEach(cb => {
        cb.checked = true;
    });
}

function deseleccionarTodos() {
    document.querySelectorAll('input[name="detalles"]').forEach(cb => {
        cb.checked = false;
    });
}

// ORDENAR POR DIA Y HORARIO
document.addEventListener("DOMContentLoaded", function () {

    const diasOrden = {
        "Lunes": 1,
        "Martes": 2,
        "MiÃ©rcoles": 3,
        "Miercoles": 3,
        "Jueves": 4,
        "Viernes": 5,
        "SÃ¡bado": 6,
        "Sabado": 6,
        "Domingo": 7
    };

    const contenedor = document.getElementById("lista-materias");
    const items = Array.from(contenedor.querySelectorAll(".materia-item"));

    items.sort((a, b) => {

        const horarioA = a.dataset.horario;
        const horarioB = b.dataset.horario;

        const diaA = horarioA.split(" ")[0];
        const diaB = horarioB.split(" ")[0];

        const horaA = horarioA.match(/\d+/);
        const horaB = horarioB.match(/\d+/);

        const ordenDia = (diasOrden[diaA] || 99) - (diasOrden[diaB] || 99);
        if (ordenDia !== 0) return ordenDia;

        return (horaA ? parseInt(horaA[0]) : 0) - (horaB ? parseInt(horaB[0]) : 0);
    });

    items.forEach(item => contenedor.appendChild(item));
});

</script>

</body>
</html>